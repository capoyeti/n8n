{
  "id": "U5hGevNAVwzF2g7v",
  "name": "Clever Mall ChatBot-v2",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "6479c7f1-acc6-4baa-acfc-46f5dd01e848",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        -2400,
        960
      ],
      "typeVersion": 1.1,
      "webhookId": "f7265859-dacd-45c9-a57b-872b77d2cb9b",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.from.id }}",
        "text": "={{ $('AI Agent').item.json.output.replace(/&/g, \"&amp;\").replace(/>/g, \"&gt;\").replace(/</g, \"&lt;\").replace(/\"/g, \"&quot;\") }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "c4dcfcf6-3bba-4f61-a003-64fbfdfb1d6f",
      "name": "Correct errors",
      "type": "n8n-nodes-base.telegram",
      "position": [
        -2032,
        1168
      ],
      "typeVersion": 1.1,
      "webhookId": "208eeaa3-53cd-4653-b5b8-964b3c8b4c31",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {
        "name": "database",
        "description": "Details about the shopping Mall and all the stores within it"
      },
      "id": "64f05417-ba9e-47bc-b1f2-1e877b7e669a",
      "name": "database",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        -3536,
        1392
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "bee279a9-b068-47c0-b445-5c3d4b83357e",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -3696,
        1760
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "fe525548-e498-4ec4-878e-c15069b6bdca",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -3296,
        1568
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "4047e2c6-c00d-42e5-9bef-482f1399b289",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        -4032,
        880
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{ $json.message.from.id }}"
      },
      "id": "6ce9019e-515b-45bf-8137-60eced44df4f",
      "name": "Telegram2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -4304,
        1040
      ],
      "webhookId": "93a6bcf5-43e6-49a2-8004-91bc95468473",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {},
      "id": "99ae4505-a099-438d-9362-2d1a7a9206cd",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1456,
        800
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "8f171609-9804-4079-80a4-acd1cdca658d",
      "name": "OpenAI Chat Model2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -3376,
        1120
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "3193d014-7ba9-4c52-868d-c0842fcd9c4f",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -5328,
        752
      ],
      "webhookId": "48a9ddf5-3f83-4bcc-b438-8a9dfa89c6ab",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "chat_with_{{ $('Telegram Trigger').first().json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "id": "0b77faa5-553a-4a68-b0f0-1b08183c2718",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.2,
      "position": [
        -3232,
        1120
      ]
    },
    {
      "parameters": {
        "pineconeIndex": {
          "__rl": true,
          "value": "clever-assets",
          "mode": "list",
          "cachedResultName": "clever-assets"
        },
        "options": {
          "pineconeNamespace": "cleverMall-rag"
        }
      },
      "id": "df792254-3464-4c2b-8293-48c9507eb6b3",
      "name": "Pinecone Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1,
      "position": [
        -3616,
        1568
      ],
      "credentials": {
        "pineconeApi": {
          "id": "4YhGmXWhVz5bAAOO",
          "name": "PineconeApi VisibleProjects"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=# CleverMall AI Assistant - Enhanced System Prompt\n\nYou are the CleverMall AI Assistant. Always greet users naturally using their first name: {{ $('Telegram Trigger').item.json.message.from.first_name }}\n\n**Current Date:** {{ $now }} \n**Default Timezone:** South African Standard Time (GMT+2)\n\n---\n\n## ðŸŽ¯ CORE DECISION MATRIX\n\n**For any user request, follow this exact decision tree:**\n\n### 1. MALL/STORE INFORMATION QUERIES\n- **When:** Questions about shops, store hours, mall layout, tenant details, policies\n- **Action:** Use **\"database\"** tool FIRST\n- **Examples:** \"What shops are in the mall?\", \"When does Store X close?\", \"Tell me about the food court\"\n\n### 2. PEOPLE/CONTACT OPERATIONS\n**ALWAYS start with contact lookup for ANY people-related task:**\n\n#### Step A: Contact Discovery\n- **\"Get Contact information\"** - Search for specific person by name\n- **\"List all contacts\"** - When you need to see all available contacts or if specific search fails\n\n#### Step B: Contact Actions (only after Step A)\n- **\"Gmail\"** - Send emails (requires email from contact lookup)\n- **\"Make appointments in Calendar\"** - Schedule meetings (requires contact details)\n- **\"Get Appointments from Calendar\"** - Check availability\n- **\"Add Contact\"** - Create new contact (when person not found and you have their details)\n\n### 3. DOCUMENT SHARING\n- **\"Get document URL for sending\"** - Retrieve document links for sharing\n- **Never attach documents - always share links**\n- **Never assume which document to send - always ask for user confirmation**\n- **Show all available documents when request is unclear**\n\n### 4. EXTERNAL INFORMATION\n- **\"Research Agent\"** - For questions not answered by database tool\n- **\"Calculator\"** - Mathematical computations\n\n---\n\n## ðŸ”§ TOOL USAGE SPECIFICATIONS\n\n### âš ï¸ IMPORTANT: Field Name Configuration\n**Before using contact tools, ensure your n8n nodes use the exact field names from your Airtable:**\n- Check your Airtable Contacts table column headers\n- Update n8n node configurations to match exactly\n- Common mismatches: \"Mobile\" vs \"Phone\", \"Email\" vs \"Email Address\"\n\n### DATABASE TOOL\n```\nTool: \"database\"\nUse for: Mall information, store details, tenant data, policies\nParameters: None required - it uses vector search automatically\nAlways try this FIRST for mall-related questions\n```\n\n### CONTACT MANAGEMENT TOOLS\n\n#### Get Contact Information\n```\nTool: \"Get Contact information\"\nParameters: { \"name\": \"exact_person_name\" }\nReturns: [UPDATE WITH YOUR ACTUAL FIELD NAMES]\nUse: Before any email/meeting action\nNote: Check your Airtable to confirm exact field names\n```\n\n#### List All Contacts\n```\nTool: \"List all contacts\"  \nParameters: None\nReturns: All contacts with available fields from your Airtable\nUse: When specific contact search fails or user asks \"who can I contact?\"\n```\n\n#### Add Contact\n```\nTool: \"Add Contact\"\nRequired Parameters: { \n  \"name\": \"person_name\",\n  \"emailAddress\": \"email@domain.com\", \n  \"phoneNumber\": \"+27XXXXXXXXX\" \n}\nUse: Only when contact doesn't exist and user provides details\nNote: Parameter names must match your Airtable field names exactly\n```\n\n### COMMUNICATION TOOLS\n\n#### Gmail\n```\nTool: \"Gmail\"\nRequired Parameters: {\n  \"email_address\": \"from_contact_lookup\",\n  \"Subject\": \"clear_subject_line\",\n  \"emailBody\": \"message_content + signature\"\n}\nCRITICAL: Always end emails with:\n\"Warm regards,\nCleverMall Management Team\"\n```\n\n#### Calendar Management\n```\nTool: \"Get Appointments from Calendar\"\nParameters: {\n  \"oneDayBefore\": \"YYYY-MM-DDTHH:MM:SS+02:00\",\n  \"oneDayAfter\": \"YYYY-MM-DDTHH:MM:SS+02:00\"\n}\n\nTool: \"Make appointments in Calendar\"\nParameters: {\n  \"startDateTime\": \"YYYY-MM-DDTHH:MM:SS+02:00\",\n  \"endDateTime\": \"YYYY-MM-DDTHH:MM:SS+02:00\",\n  \"summary\": \"meeting_title\",\n  \"description\": \"meeting_details\",\n  \"attendeeList\": \"email1@domain.com,email2@domain.com\"\n}\n```\n\n### DOCUMENT SHARING\n```\nTool: \"Get document URL for sending\"\nParameters: None required\nReturns: Limited list of document names and URLs (max 5)\nCRITICAL PROCESS:\n1. Only call this tool when user specifically requests a document\n2. After getting results, analyze user's request against available documents\n3. If multiple documents returned, show ALL options and ask user to choose\n4. NEVER auto-select the first document in the list\n5. If no clear match, ask user to be more specific about which document they need\n```\n\n---\n\n## âš ï¸ CRITICAL RULES\n\n### Contact Information Rules\n1. **NEVER invent email addresses or phone numbers**\n2. **NO \"example.com\" or fake emails**\n3. **Always check contacts database before asking for details**\n4. **If contact missing, ask user to provide real email/phone**\n\n### Document Selection Rules\n1. **NEVER automatically select documents without user confirmation**\n2. **Always show available document options when request is unclear**\n3. **Match documents specifically to user's stated need**\n4. **If no clear match, ask for clarification rather than defaulting**\n\n### Tool Execution Order\n1. **People Operations:** Contact lookup â†’ Action tool\n2. **Mall Questions:** Database tool â†’ Research tool (if needed)\n3. **Document Sharing:** Get document URL â†’ Include in email/response\n\n### Response Formatting\n- Clean, simple output without HTML artifacts\n- Proper markdown formatting\n- Professional tone matching business context\n- Include relevant contact details when found\n\n---\n\n## ðŸ“„ EXAMPLE WORKFLOWS\n\n### Scenario: \"Send John the mall directory\"\n```\n1. Use \"Get Contact information\" with name=\"John\"\n2. If found: Use \"Get document URL for sending\" \n3. Use \"Gmail\" with John's email, subject about directory, include document link\n4. If not found: Use \"List all contacts\" to show options OR ask for John's email\n```\n\n### Scenario: \"What stores sell electronics?\"\n```\n1. Use \"database\" tool to search for electronics stores\n2. Provide comprehensive answer from database results\n3. If database doesn't have info, use \"Research Agent\"\n```\n\n### Scenario: \"Schedule meeting with Sarah tomorrow 2pm\"\n```\n1. Use \"Get Contact information\" with name=\"Sarah\"\n2. Use \"Get Appointments from Calendar\" to check availability\n3. Use \"Make appointments in Calendar\" with Sarah's email and specified time\n4. Confirm booking with user\n```\n\n---\n\n**Remember:** Be decisive, action-oriented, and always prioritize accurate information from your tools over assumptions. When in doubt, ask for clarification rather than guessing."
        }
      },
      "id": "b0dbd7f9-07d5-4e7a-a26f-320925d05a6b",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -3056,
        960
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appErtFpBiEZfLdMm",
          "mode": "list",
          "cachedResultName": "CleverMall",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm"
        },
        "table": {
          "__rl": true,
          "value": "tblnbG5vo8mFD3BZ0",
          "mode": "list",
          "cachedResultName": "Contacts",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm/tblnbG5vo8mFD3BZ0"
        },
        "filterByFormula": "={Name} = \"{{ $fromAI('name') }}\"",
        "options": {
          "fields": [
            "Email",
            "Mobile",
            "Notes",
            "Job Title"
          ]
        }
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        -3024,
        1232
      ],
      "id": "e1bacc94-4462-4b74-84f3-7f3200e47cf2",
      "name": "Get Contact information",
      "credentials": {
        "airtableTokenApi": {
          "id": "jO5P27PvyEErPtGX",
          "name": "Airtable Personal Access Token account CleverAssets"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $fromAI('email_address') }}",
        "subject": "={{ $fromAI('Subject') }}",
        "emailType": "text",
        "message": "={{ $fromAI('emailBody') }}",
        "options": {
          "appendAttribution": false,
          "senderName": "CleverMall Management team"
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        -2784,
        1168
      ],
      "id": "9f25204e-edb3-4cc1-bbc7-7652b88e5c74",
      "name": "Gmail",
      "webhookId": "7f2dc900-d5db-4419-a76f-6294ca202955",
      "credentials": {
        "gmailOAuth2": {
          "id": "QF7l9tuBbTaWOH86",
          "name": "gmail api (n8n and related project)"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "687276c40bf5743df474fb3edff1019d924265158a8271fde94abdc76d4a9fd0@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "CleverMall Events"
        },
        "start": "={{ $fromAI('startDateTime') }}",
        "end": "={{ $fromAI('endDateTime') }}",
        "additionalFields": {
          "attendees": [
            "={{ $fromAI('attendeeList') }}"
          ],
          "description": "={{ $fromAI('description') }}",
          "summary": "={{ $fromAI('summary') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.2,
      "position": [
        -2560,
        1200
      ],
      "id": "3d64c966-95b3-48b8-8147-4b13d34c5a73",
      "name": "Make appointments in Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "2WyKcCWBhILiJqvx",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "687276c40bf5743df474fb3edff1019d924265158a8271fde94abdc76d4a9fd0@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "CleverMall Events"
        },
        "returnAll": true,
        "options": {
          "timeMin": "={{ $fromAI('oneDayBefore','one day before the day the user requested') }}",
          "timeMax": "={{ $fromAI('oneDayAfter','one day after the day the user requested') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.2,
      "position": [
        -2896,
        1392
      ],
      "id": "9d0653ee-5bfa-430c-aa3e-4f9e4bd31aa6",
      "name": "Get Appointments from Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "2WyKcCWBhILiJqvx",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "name": "Research_Agent",
        "description": "Call this tool to search the internet and answer the users question.",
        "workflowId": {
          "__rl": true,
          "value": "Qq0iYmoQkiAYDox8",
          "mode": "list",
          "cachedResultName": "Research Agent"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -2752,
        1392
      ],
      "id": "e48ec83e-2c3c-4862-85e1-38ebd73cfcfb",
      "name": "Research Agent"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.voice.file_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8b143a29-c71d-46eb-89fd-7f0529177c89",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -4960,
        752
      ],
      "id": "ecf05fff-c616-4e26-bce5-11c066b35b4a",
      "name": "Switch"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34ca9e2a-c867-436a-9a22-4503b467bca9",
              "name": "text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "f2c068af-177a-4792-b6c2-89b2d30f242d",
              "name": "Message_Type",
              "value": "text",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4304,
        768
      ],
      "id": "44ed8dfc-92bb-4878-a4f0-23be2e80d48a",
      "name": "Set 'Text'"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -4304,
        352
      ],
      "id": "60359ca5-8984-429c-bed9-30a241dbfe67",
      "name": "Download Voice File",
      "webhookId": "87bf518d-1914-43eb-b3b0-ddae855eea38",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        -4032,
        352
      ],
      "id": "be9c2c70-ed4a-4c1e-b172-eeac74a1800f",
      "name": "Transcribe recording",
      "credentials": {
        "openAiApi": {
          "id": "StTWW03POtmODq8b",
          "name": "Clever Assets (Mall)"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=Summarise this incoming information: {{ $json.output }}\n\nOutput only plain text. There should be no formatting or symbols. ",
              "role": "system"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        -3040,
        768
      ],
      "id": "e9a7a718-4f9c-47c0-8bcb-43e0dd58c696",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "StTWW03POtmODq8b",
          "name": "Clever Assets (Mall)"
        }
      }
    },
    {
      "parameters": {
        "content": "## Disconnected\n- maybe consider using this chatbot to summarise or condense the response so voice responses aren't so wordy.\n ",
        "height": 440,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3104,
        496
      ],
      "id": "4e0f646b-ff09-4e6b-8b2f-efcd9cc14ecc",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -2560,
        1408
      ],
      "id": "de649706-fa25-4286-8b2c-eb53654e4aac",
      "name": "Calculator"
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appErtFpBiEZfLdMm",
          "mode": "list",
          "cachedResultName": "CleverMall",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm"
        },
        "table": {
          "__rl": true,
          "value": "tblnbG5vo8mFD3BZ0",
          "mode": "list",
          "cachedResultName": "Contacts",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm/tblnbG5vo8mFD3BZ0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $fromAI('name') }}",
            "Email": "={{ $fromAI('emailAddress') || '' }}",
            "Mobile": "={{ $fromAI('phoneNumber') || '' }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Todo",
                  "value": "Todo"
                },
                {
                  "name": "In progress",
                  "value": "In progress"
                },
                {
                  "name": "Done",
                  "value": "Done"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Mobile",
              "displayName": "Mobile",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        -3024,
        1600
      ],
      "id": "56cab833-d68f-485b-ae14-3b07e4d585f8",
      "name": "Add Contact",
      "credentials": {
        "airtableTokenApi": {
          "id": "jO5P27PvyEErPtGX",
          "name": "Airtable Personal Access Token account CleverAssets"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appErtFpBiEZfLdMm",
          "mode": "list",
          "cachedResultName": "CleverMall",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm"
        },
        "table": {
          "__rl": true,
          "value": "tblnbG5vo8mFD3BZ0",
          "mode": "list",
          "cachedResultName": "Contacts",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm/tblnbG5vo8mFD3BZ0"
        },
        "options": {
          "fields": [
            "Name",
            "Email",
            "Notes",
            "Job Title",
            "Contact"
          ],
          "view": {
            "__rl": true,
            "value": "viws70YJxkksqd6x4",
            "mode": "list",
            "cachedResultName": "Grid view",
            "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm/tblnbG5vo8mFD3BZ0/viws70YJxkksqd6x4"
          }
        }
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        -2816,
        1600
      ],
      "id": "20c942c7-1471-479f-b900-0b88dac54c71",
      "name": "List all contacts",
      "credentials": {
        "airtableTokenApi": {
          "id": "jO5P27PvyEErPtGX",
          "name": "Airtable Personal Access Token account CleverAssets"
        }
      }
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "65ea4aae-c0c3-45b0-93c7-b79af20f1776",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "position": [
        -3312,
        480
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{ $json.message.from.id }}"
      },
      "id": "09742e2c-2a4c-4311-8dec-52eb471b7fc7",
      "name": "Telegram3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -4304,
        560
      ],
      "webhookId": "e3f9765b-e479-448d-a458-b2448dabf091",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ZFSwEVTAa9MAgJ-PZjjNApU-FQ-jk_rLvLFQ5DwF8eo",
          "mode": "list",
          "cachedResultName": "CleverMall Execution",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZFSwEVTAa9MAgJ-PZjjNApU-FQ-jk_rLvLFQ5DwF8eo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZFSwEVTAa9MAgJ-PZjjNApU-FQ-jk_rLvLFQ5DwF8eo/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Workflow": "={{ $workflow.name }}",
            "Text": "={{ $('Telegram Trigger').item.json.message.text }}",
            "First Name": "={{ $('Telegram Trigger').item.json.message.chat.first_name }}",
            "Last Name": "={{ $('Telegram Trigger').item.json.message.chat.last_name }}",
            "Date": "={{ new Date($('Telegram Trigger').item.json.message.date * 1000).toISOString() }}",
            "Result": "={{ $json.result.text }}",
            "ChatBot": "={{ $json.result.from.username }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Workflow",
              "displayName": "Workflow",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ChatBot",
              "displayName": "ChatBot",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Text",
              "displayName": "Text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Result",
              "displayName": "Result",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1808,
        560
      ],
      "id": "e16a8140-18d4-4017-a6d0-681807001cec",
      "name": "Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "EMycuXif3kCAGGin",
          "name": "Clever Assets Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "content": "## Audio Length \nCareful - this is limited to 25MB. \nHow to work around this?",
        "height": 340
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4304,
        224
      ],
      "id": "cec100a1-c1ac-4cf3-91d1-7f41c4c6b568",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appErtFpBiEZfLdMm",
          "mode": "list",
          "cachedResultName": "CleverMall",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm"
        },
        "table": {
          "__rl": true,
          "value": "tbljTX8ctlcW5mJsZ",
          "mode": "list",
          "cachedResultName": "Documents",
          "cachedResultUrl": "https://airtable.com/appErtFpBiEZfLdMm/tbljTX8ctlcW5mJsZ"
        },
        "filterByFormula": "=",
        "options": {
          "fields": [
            "url",
            "Name"
          ]
        }
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        -2640,
        1568
      ],
      "id": "f3f76956-248f-4127-b1b8-d2fcf13d1f7d",
      "name": "Get document URL for sending",
      "credentials": {
        "airtableTokenApi": {
          "id": "jO5P27PvyEErPtGX",
          "name": "Airtable Personal Access Token account CleverAssets"
        }
      }
    },
    {
      "parameters": {
        "resource": "speech",
        "voice": {
          "__rl": true,
          "value": "PbIcS3aox0m945j934Nk",
          "mode": "list",
          "cachedResultName": "Chad Stoffel"
        },
        "text": "={{ $('AI Agent1').item.json.output }}",
        "additionalOptions": {},
        "requestOptions": {}
      },
      "type": "@elevenlabs/n8n-nodes-elevenlabs.elevenLabs",
      "typeVersion": 1,
      "position": [
        -2432,
        656
      ],
      "id": "1048960c-86a1-4c5d-8bb2-c7673f002b31",
      "name": "Convert text to speech",
      "credentials": {
        "elevenLabsApi": {
          "id": "nLAdnb5HzdvH6wSu",
          "name": "ElevenLabs account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $('set_message_type').item.json.Message_Type }}",
              "rightValue": "voice",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "ab1d6e4c-6e15-41c4-a2f1-55983186f422"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [
        -2656,
        816
      ],
      "id": "58512d32-acb2-4cfc-8409-0c3ce4cef972",
      "name": "Check if Audio Input"
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {
          "fileName": "response.mp3"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2224,
        656
      ],
      "id": "5aeac099-8c97-440f-ba0c-36dc67d5f5fe",
      "name": "Send Audio Response",
      "webhookId": "audio-response-webhook",
      "credentials": {
        "telegramApi": {
          "id": "bYFmZz96wR9Hekkv",
          "name": "CleverMall_Bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f75a836f-27f2-4267-9172-81ccfda02d6b",
              "name": "Message_Type",
              "value": "voice",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4656,
        480
      ],
      "id": "dd995e07-930e-450c-9593-0ab9501b0a1c",
      "name": "set_message_type"
    }
  ],
  "connections": {
    "Telegram": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          },
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Correct errors",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Correct errors": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "database": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "database",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Telegram2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "database",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Audio Input": {
      "main": [
        [
          {
            "node": "Convert text to speech",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert text to speech": {
      "main": [
        [
          {
            "node": "Send Audio Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Audio Response": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Contact information": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Gmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Make appointments in Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Appointments from Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Research Agent": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Telegram3",
            "type": "main",
            "index": 0
          },
          {
            "node": "set_message_type",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set 'Text'",
            "type": "main",
            "index": 0
          },
          {
            "node": "Telegram2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Voice File": {
      "main": [
        [
          {
            "node": "Transcribe recording",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe recording": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set 'Text'": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        []
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Add Contact": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "List all contacts": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram3": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get document URL for sending": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set_message_type": {
      "main": [
        [
          {
            "node": "Download Voice File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "0YP0ar9neq5yTIPz"
  },
  "tags": [
    {
      "updatedAt": "2024-10-09T16:01:57.106Z",
      "createdAt": "2024-10-09T16:01:57.106Z",
      "id": "SNa1Vw3aUYYz8QRe",
      "name": "working"
    },
    {
      "updatedAt": "2024-09-24T18:08:43.910Z",
      "createdAt": "2024-09-24T18:08:43.910Z",
      "id": "Tej2PW2VcNzkvBHB",
      "name": "chatbot"
    },
    {
      "updatedAt": "2024-10-09T16:08:23.899Z",
      "createdAt": "2024-10-09T16:08:23.899Z",
      "id": "fdV01E9B5XB3kSxT",
      "name": "pinecone"
    },
    {
      "updatedAt": "2024-09-21T19:53:19.299Z",
      "createdAt": "2024-09-21T19:53:19.299Z",
      "id": "sKkwnItsSnVITUWx",
      "name": "telegram"
    }
  ],
  "staticData": null,
  "meta": {},
  "pinData": {}
}