{
  "id": "jMIJ9ZsxulTuvRxh",
  "name": "Testing Postgres",
  "active": false,
  "nodes": [
    {
      "parameters": {},
      "id": "3481e656-8002-4abc-885a-2b7c31487252",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        340,
        -100
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "d28a1c3e-2beb-47a1-b5f9-fa6a53382bc1",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        1500,
        1120
      ],
      "webhookId": "f13955a7-0fdc-4c05-9988-00d15de883d8"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "6b76aeb9-632b-401e-be53-65113e9ff1e0",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        840,
        680
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "c97125b7-5b16-45ed-aa8f-54d0fc35e6f6",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        780,
        900
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "id": "20d7d940-cd14-400f-9bb9-fba9d7b9919f",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.1,
      "position": [
        920,
        900
      ],
      "credentials": {
        "postgres": {
          "id": "sSanowxVnhwfWmeX",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "1x9rJD8GtWXQnCkZehcbECFdzL3yu56ML",
            "mode": "list",
            "cachedResultName": "tls-rag",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1x9rJD8GtWXQnCkZehcbECFdzL3yu56ML"
          }
        },
        "options": {}
      },
      "id": "18005fb3-3870-4df6-9246-d29a61c4d250",
      "name": "Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        560,
        -100
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "9Li8NNfcRaRSLphW",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "id": "dfba3fc8-5c2a-4d26-9d67-5f0869485631",
      "name": "Google Drive1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        860,
        -80
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "9Li8NNfcRaRSLphW",
          "name": "Google Drive account 3"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "9f2eff0e-4026-457c-8a69-a3f363aaa842",
      "name": "CleverAssets - Supabase Insert",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        1220,
        0
      ],
      "credentials": {
        "supabaseApi": {
          "id": "0Rs3TNzy3wQvVaoG",
          "name": "CleverMall Projects"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "7bdbb698-d8b6-4189-ab92-f83b299eda37",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        1060,
        220
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "ed90a74a-5f7d-4756-a9de-79a42a20d45e",
      "name": "Question and Answer Chain",
      "type": "@n8n/n8n-nodes-langchain.chainRetrievalQa",
      "typeVersion": 1.3,
      "position": [
        2080,
        480
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9cd57c4f-a4fb-4c6e-869f-4160522f2c01",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        2000,
        740
      ],
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are a helpful DB assistant that is helping the user look up landlord, mall and tenant data. \n\nYou will be asked questions in natural language and must use the \"DB Schema\" tool to get an understanding of which tables are available in the database.  \nBased on that, you can then fetch the table definitions using the \"Get Table Schema\" tool, which is available to you and gives you all of the column and field names for the tables and also relationships. \n\nFinally, run the \"Get Queried Data\" tool to get the data and answer in natural language. Important, wrap the table name and the column name in double quotes. \n\nToday's date is {{$now}}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1760,
        1120
      ],
      "id": "18e00846-d4f2-4000-ae05-2e68cde6e412",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1520,
        1340
      ],
      "id": "8060bee5-3d0c-4ec0-af15-6a029674505c",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "nqrhFGUWwy6HdEUN",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT table_schema, table_name\nFROM information_schema.tables\nWHERE table_type = 'BASE TABLE' \nAND table_schema = 'public';\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        1960,
        1360
      ],
      "id": "8d01d90f-9f06-419e-bd55-79900a1cb5b2",
      "name": "DB Schema",
      "credentials": {
        "postgres": {
          "id": "eMHqe3tBWaf672Q3",
          "name": "Clever Mall Database"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    c.column_name,\n    c.data_type,\n    c.is_nullable,\n    c.column_default,\n    tc.constraint_type,\n    ccu.table_name AS referenced_table,\n    ccu.column_name AS referenced_column\nFROM information_schema.columns c\nLEFT JOIN information_schema.key_column_usage kcu \n    ON c.table_name = kcu.table_name \n    AND c.column_name = kcu.column_name\nLEFT JOIN information_schema.table_constraints tc \n    ON kcu.constraint_name = tc.constraint_name \n    AND tc.constraint_type = 'FOREIGN KEY'\nLEFT JOIN information_schema.constraint_column_usage ccu \n    ON tc.constraint_name = ccu.constraint_name\nWHERE \n    c.table_name = '{{ $json[\"table_name\"] }}' -- Your table name from n8n\n    AND c.table_schema = 'public' -- Adjust schema if needed\nORDER BY \n    c.ordinal_position;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        1820,
        1340
      ],
      "id": "94f9b2ba-f289-4cfc-b596-e88f65b6505f",
      "name": "Get Table Schema",
      "credentials": {
        "postgres": {
          "id": "5g89SinPuuPmFGm2",
          "name": "CleverAssets New"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $fromAI('query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        2120,
        1360
      ],
      "id": "3223f5b9-1626-4556-a6dc-f4ff696e216f",
      "name": "Get Queried Data",
      "credentials": {
        "postgres": {
          "id": "sSanowxVnhwfWmeX",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1660,
        1340
      ],
      "id": "9658e890-9482-4bdd-9a38-591898b0ea98",
      "name": "Window Buffer Memory"
    }
  ],
  "connections": {
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Google Drive1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive1": {
      "main": [
        []
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "CleverAssets - Supabase Insert",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Question and Answer Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "DB Schema": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Table Schema": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Queried Data": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [],
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {}
}